.container.movers{"data-ng-controller" => "MoversListCtrl"}
  .col-md-4.hidden-xs.hidden-sm
    = render partial: "movers_list_sidebar", locals: {from: @from, to: @to}

  .col-md-8.col-xs-12
    %p.lead= "displaying {{ filteredMovers.length }} of #{@mover_list_items.size} movers"
    = render partial: "mover_list_items"

= render partial: "booking_modal"

:javascript
  var app = angular.module("mule", []);

  app.controller("MoversListCtrl", function($scope, ServiceService) {
    $scope.mover_list_items = #{@mover_list_items.to_json}
    $scope.filteredServices = {}
    $scope.services = ServiceService.getServices();
  });

  app.factory("ServiceService", function () {
    var services = [
      {
        "category": "Pickup",
        "items": [
          { id: "packaging", name: "Packaging" },
          { id: "crating", name: "Crating" },
          { id: "furniture_wrapping", name: "Furniture Wrapping" },
          { id: "furniture_disassembly", name: "Furniture Disassembly" },
          { id: "personal_truck_loading", name: "Personal Truck Loading" },
          { id: "appliances_uninstall", name: "Appliances Uninstall" }
        ]
      },
      {
        "category": "Transport",
        "items": [
          { id: "shuttling", name: "Shuttling" },
          { id: "storage", name: "Storage" },
          { id: "extra_stops", name: "Extra Stops" }
        ]
      },
      {
        "category": "Dropoff",
        "items": [
          { id: "furniture_assembly", name: "Furniture Assembly" },
          { id: "appliances_install", name: "Appliances Install" }
        ]
      },
      {
        "category": "Special",
        "items": [
          { id: "electronics_packaging", name: "Electronics Packaging" },
          { id: "auto_transport", name: "Auto Transport" },
          { id: "bulky_items", name: "Bulky Items" },
          { id: "pianos", name: "Pianos" },
          { id: "gun_safe", name: "Gun Safe" },
          { id: "cleaning", name: "Cleaning" }
        ]
      }
    ]

    var getServices = function () {
      return services;
    }

    return {
      getServices: getServices
    }
  })

  app.filter("serviceFilter", function($filter) {
    return function(mover_list_items, filteredServices) {

      // exclude services set to false
      var requestedServices = {}
      $.each(filteredServices, function(key, val) {
        if (val === true) {
          requestedServices[key] = true
        }
      });

      return $filter("filter")(mover_list_items, requestedServices);
    }
  });

  $("[data-target=#bookModal]").click(function (e) {
    var $target = $(e.target);
    var moverId = $target.data("mover-id");
    var moverName = $target.data("mover");
    var moverStars = $target.data("stars");

    $("#booking_mover_id").val(moverId);
    $("#modalMoverName").text(moverName);
    $("#modalMoverStars").attr("data-rating", moverStars);
  });
